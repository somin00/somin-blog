---
title: "Cafe In 프로젝트 리팩토링 하기"
date: "2024-01-02"
description: "리팩토링 한 내용과 느낀점🙂"
---

올해의 첫 포스팅! 연말이라 들뜬 마음은 넣어두고... 올 한 해도 파이팅!🍀  
&nbsp;

오늘은 작년 7-8월에 진행한 카페인 프로젝트 리팩토링에 대한 내용을 정리하려고 한다. 사실 리팩토링을 인턴십이 끝난 10월부터 하고 싶었는데 사람들이 일정이 안돼서 혼자 진행하지 못하고 기다리다가 한 명이 가능하다고 해서 시작했다. 조금 늦은 감이 있지만 그동안 학습한 것을 적용하다 보면 더 퀄리티 좋은 코드가 나오겠지 하는 기대를 안고 시작했다.  
&nbsp;

### **[리팩토링 항목]**

- 데이터 페칭 로직 반복 줄이기
- 데이터베이스 메서드 한 파일에 모으기
- 컴포넌트 파일 내 로직 분리하기
- 상태 관리 커스텀 훅

&nbsp;

### 1. 데이터 페칭 로직 반복 줄이기

파이어베이스를 백엔드로 사용해서 데이터를 불러오는 코드가 거의 동일했다. 어떤 데이터를 가져오느냐에 따라 인자가 달라지는 정도였다. 데이터 페칭 코드가 한 두개라면 굳이 리팩토링하지 않았을 것이다. 하지만 카페 서비스라서 대부분의 데이터가 백엔드에 저장되어 있어서 반복이 정말 많았다. 우선 코드가 매우 길어서 가독성이 떨어지는게 이 부분을 리팩토링한 가장 큰 이유다.  
&nbsp;

useFetch 커스텀 훅으로 데이터 페칭하는 코드를 분리했을 때 코드를 약 60줄이나 삭제했다. 컴포넌트 파일에 로직 코드가 60줄이나 있었다니 당연히 가독성이 안 좋을 수밖에 없다🥲.  
코드 분리를 통해 불필요한 반복을 줄이고 코드 가독성도 높이는 효과를 보았다.
![데이터 페칭 커스텀 훅 변화 내용 {728x64}](https://github.com/Cafe-Manage-Service-CAFE-IN/cafe-in/assets/61578822/4be757d7-4b8b-49c3-abbd-cce6cdd3f463)
[GitHub에서 코드 보기](https://github.com/Cafe-Manage-Service-CAFE-IN/cafe-in/blob/develop/src/hooks/useFetchWithQuery.ts)  
&nbsp;

### 2. 데이터베이스 메서드 한 파일에 모으기

이 작업은 사실 굳이 하지 않아도 되는 작업이었지만 데이터베이스 관련 메서드를 사용하는 모든 파일에서 import 하여 사용하는 것보다 통일 시키는 것이 좋을 것 같다고 판단하여 해 본 작업이다.
리팩토링할 때가 아니라 기능 구현할 때 했더라면 정말 편하게 사용했을 것 같다. 필요할 때마다 문서를 보지 않아도 되고 import가 잘못될 걱정도 안 해도 되고 유용한 것 같다.

[GitHub에서 코드 보기](https://github.com/Cafe-Manage-Service-CAFE-IN/cafe-in/blob/develop/src/utils/db.ts)  
&nbsp;

### 3. 컴포넌트 파일 내 로직 분리하기

불과 약 5개월 전의 나 코드 정말 못 짰다... 컴포넌트 파일에 다 작성할 거면 파일 분리는 도대체 왜 하고 있는 건가 싶을 정도로 코드 분리를 안 했다.. 이제라도 느꼈으니 제대로 해보자 생각하고 했지만.. 이렇게 하는 게 맞는지는 잘 모르겠다🥲
기능에 따라 아래와 같이 폴더 및 파일을 나누어서 분리했다.

![함수 분리 {544x460}](https://github.com/Cafe-Manage-Service-CAFE-IN/cafe-in/assets/61578822/9e9324e8-1bf4-4188-9ac0-121dbeba05a2)
데이터베이스에 접근하여 데이터를 조작하는 기능들은 \*DB.ts 파일에 작성하고 나머지 유효성 검사와 관련한 것들은 check\*.ts 파일에 작성했다.  
&nbsp;

### 4. 상태 관리 커스텀 훅

내가 맡은 부분이 form이 많아서인지 state로 관리할 것이 많았다. 사실 이 커스텀 훅은 제대로 작성한 것인지 필요한 것인지 판단이 잘 서지 않았다. 하지만 다른 팀원 또한 나쁘지 않은 것 같다고 해서 우선 유지하는 걸로 결정했다.
분리한 이유는 setState를 통한 연속적인 상태 변화가 직관적이지 않았고 객체를 변경할 경우 반복되는 코드가 많았다. 타입스크립트 제네릭 사용에 익숙하지 않아서 검색만 몇 번을 했는지 모르겠다..🥲 검색해서 겨우 했지만 잘 작성한 건지도 모르겠다..! 팀원 도 괜찮다고 했으니 일단 두었다🤣
![useInput 함수 {632x592}](https://github.com/Cafe-Manage-Service-CAFE-IN/cafe-in/assets/61578822/df0f2f36-40b9-4313-85cd-076b09283db3)
[GitHub에서 코드 보기](https://github.com/Cafe-Manage-Service-CAFE-IN/cafe-in/blob/develop/src/hooks/useInput.ts)  
&nbsp;

### 느낀점

그동안 관심사의 분리라는 말을 정말 많이 들었지만 다른 사람들 코드로는 와닿아도 내 코드로는 관심사의 분리를 도대체 어떻게 해야 잘 한 걸까 하는 의문이 계속 있었다. 이번 리팩토링을 통해 완벽하게는 아니지만 관심사의 분리 그 어디쯤인가는.. 경험을 한 것이 아닐까 싶다! 리팩토링을 하려고 처음 코드를 봤을 때는 내 코드지만 무슨 의도로 짠 건지 이해하기도 쉽지 않았다. 이래서 유지 보수하기 좋은 코드가 좋은 코드라고 하나보다..🤣 아직 많이 부족한 코드지만 몇 달 만에 성장한 것 같은 느낌이 들어서 지치는 요즘 다시 한번 열심히 공부할 힘을 얻었다😊
